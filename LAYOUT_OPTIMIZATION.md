# Agent Flow Visualizer 布局优化说明

## 优化目标
解决文字重叠问题，提升可视化效果和用户体验。

## 主要优化内容

### 1. 智能节点间距算法
- **动态间距计算**：根据节点类型和文本长度动态调整间距
- **自适应布局**：基于容器宽度和节点数量智能计算每行节点数
- **最小间距保证**：确保节点间有足够的空间防止重叠

```typescript
// 动态水平间距 = max(80px, 节点宽度 * 0.4)
const horizontalPadding = Math.max(80, maxNodeWidth * 0.4);
// 动态垂直间距 = max(100px, 节点高度 * 0.8)  
const verticalPadding = Math.max(100, maxNodeHeight * 0.8);
```

### 2. 智能文本处理
- **预处理截断**：在创建节点前根据节点类型智能截断长文本
- **智能断点**：优先在单词边界、逗号、句号处截断
- **类型化长度限制**：
  - 开始/结束节点：30字符
  - 决策/思考节点：60字符  
  - 错误/工具节点：55字符
  - 其他节点：50字符

### 3. 优化节点样式
- **增加节点尺寸**：
  - 基础节点：200x100px (原180x80px)
  - 决策/思考节点：220x120px (原200x100px)
  - 错误/工具节点：210x110px (原190x90px)
- **改进文字设置**：
  - 使用省略号截断 (`text-wrap: 'ellipsis'`)
  - 减小字体大小避免拥挤 (12px/11px)
  - 优化文字对齐和边距
  - 添加文字溢出处理

### 4. 边样式优化
- **减少边宽度**：从3px减少到2px
- **优化边标签**：
  - 限制最大宽度120px
  - 允许换行显示
  - 增加背景不透明度
  - 保持文字水平显示

### 5. 布局算法改进
- **Zigzag布局优化**：
  - 考虑节点实际尺寸
  - 动态计算最优行数
  - 智能缩放控制 (0.3-0.9倍)
- **其他布局增强**：
  - Dagre: 增加节点间距 (120px) 和层级间距 (150px)
  - Cose-bilkent: 增加节点排斥力 (6000) 和理想边长 (150px)
  - Grid/Breadthfirst: 增加间距因子和内边距

### 6. 新增Smart布局
- 添加"Smart"智能布局选项
- 使用相同的智能算法但可以独立调优
- 为未来的AI驱动布局优化预留接口

## 测试数据
添加了包含长文本的测试数据集，用于验证布局优化效果：
- 12个节点，包含各种类型
- 长文本标签 (50-100字符)
- 复杂的连接关系

## 使用方法
1. 启动应用后，点击"输入日志文本"标签页
2. 点击"加载测试数据 (长文本)"按钮
3. 在布局选择器中尝试不同布局：
   - **Zigzag/Smart**: 推荐用于大多数场景
   - **Dagre**: 适合层次化流程
   - **Cose**: 适合复杂网络关系

## 效果对比
- **优化前**：节点间距固定，文字经常重叠，布局拥挤
- **优化后**：动态间距，智能文字处理，清晰可读的布局

## 技术细节
- 使用Cytoscape.js的高级样式配置
- 实现了响应式布局算法
- 添加了文本预处理管道
- 优化了渲染性能和用户交互 